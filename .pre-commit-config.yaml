repos:
  - repo: local
    hooks:
      - id: skylos-scan
        name: skylos report
        entry: python -m skylos.cli
        language: system
        pass_filenames: false
        require_serial: true
        args: [".", "--output", "report.json", "--confidence", "70", "--danger"]

      - id: skylos-fail-on-findings
        name: skylos
        env:
          SKYLOS_SOFT: "1"
        language: system
        pass_filenames: false
        require_serial: true
        entry: >
          python -c "import os,json,sys,pathlib;
          p=pathlib.Path('report.json');
          (not p.exists()) and sys.exit(0);
          data=json.loads(p.read_text(encoding='utf-8'));
          vals=(data.values() if isinstance(data,dict) else data if isinstance(data,list) else []);
          count=sum(len(v) for v in vals if isinstance(v,list));
          print(f'[skylos] findings: {count}');
          sys.exit(0 if os.getenv('SKYLOS_SOFT') or count==0 else 1)"
